"use strict";(()=>{(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1985],{1985:(Fe,b,a)=>{a.r(b),a.d(b,{Router:()=>xe});var e=a(2784),w=a(39857),g=a(73557),U=a(60885),N=a(12053),v=a(93235),f=a(89883),P=a(49558),C=a(30705),L=a(30204),T=a(64304),h=a(31011),z=a(77277),S=a(61837),Q=a(41156),k=a(88188),q=a(75650),ee=a(56563),W=a(34520),te=a(77120),ae=a(42123),x=a(79692),j=a(42494),$=a(56939),G=a(73698),V=a(12231),X=a(94339),Y=a(32552),H=a(24579),ne=a(67358),J=a(87685),le=a(2552),F=a(10921),oe=a(48760),re=a(11280),se=a(64279),ie=a(72779),Ze=a.n(ie),be=a(26228),ce=a(75951),we=a.n(ce),me=a(19126),Ne=a.n(me),Ee=a(82394),ze=a.n(Ee),de=a(31734),je=a.n(de),$e=a(68111),ue=a(82108),Ge=a.n(ue);const _e=t=>{const{title:n,to:l}=t,{allowed:i}=(0,ee.gI)({permission:q.x7}),r=(0,Q.Z)(E=>E.breakpoints.down("xs"));return!l||!i?null:r?e.createElement(S.Z,{component:w.rU,color:"primary",title:n,size:"small",to:l},e.createElement(k.Z,null)):e.createElement(z.Z,{component:w.rU,variant:"contained",color:"primary",to:l},n)},pe={title:"Templates",filter:()=>!0},fe=t=>[...t,{title:"Other Templates",filter:n=>![...t].some(({filter:l})=>l(n))}],ve=t=>{var n,l,i;const r=(0,C.tg)(f.u),{TemplateCardComponent:E,groups:s=[],templateFilter:p}=t,m=(0,g.s0)(),_=(0,C.tg)(f.p),u=(0,C.tg)(f.q),O=(0,C.tg)(f.t),c=(0,C.tg)(f.v),D=(0,C.tg)(f.o),M=(0,C.qD)(),A=s.length?fe(s):[pe],o={onEditorClicked:((n=t==null?void 0:t.contextMenu)==null?void 0:n.editor)!==!1?()=>m(_()):void 0,onActionsClicked:((l=t==null?void 0:t.contextMenu)==null?void 0:l.actions)!==!1?()=>m(u()):void 0,onTasksClicked:((i=t==null?void 0:t.contextMenu)==null?void 0:i.tasks)!==!1?()=>m(O()):void 0},d=(0,e.useCallback)(R=>{var B,K;const{kind:Be,namespace:Ke,name:Se}=(0,W.of)((0,W.eE)(R));return(B=R.metadata.annotations)!=null&&B["backstage.io/techdocs-ref"]&&c?[{icon:(K=M.getSystemIcon("docs"))!=null?K:P.zG,text:"View TechDocs",url:c({kind:Be,namespace:Ke,name:Se})}]:[]},[M,c]),y=(0,e.useCallback)(R=>{const{namespace:B,name:K}=(0,W.of)((0,W.eE)(R));m(D({namespace:B,templateName:K}))},[m,D]);return e.createElement(T.UO,null,e.createElement(P.T3,{themeId:"website"},e.createElement(P.h4,{pageTitleOverride:"Create a new component",title:"Create a new component",subtitle:"Create new software components using standard templates in your organization"},e.createElement(h.zP,{...o})),e.createElement(P.VY,null,e.createElement(P.yW,{title:"Available Templates"},e.createElement(_e,{title:"Register Existing Component",to:r&&r()}),e.createElement(P.qt,null,"Create new software components using standard templates. Different templates create different kinds of components (services, websites, documentation, ...).")),e.createElement(T._i,null,e.createElement(T._i.Filters,null,e.createElement(T.nN,null),e.createElement(T.tW,{initialFilter:"template",hidden:!0}),e.createElement(T.EW,{initialFilter:"all",availableFilters:["all","starred"]}),e.createElement(h._G,null),e.createElement(T.xE,null)),e.createElement(T._i.Content,null,e.createElement(h.ow,{groups:A,templateFilter:p,TemplateCardComponent:E,onTemplateSelected:y,additionalLinksForEntity:d}))))))},ge=t=>{const n=(0,C.tg)(f.r),l=(0,C.tg)(f.w),{secrets:i}=(0,U.u)(),r=(0,L.u)(U.s),E=(0,g.s0)(),{templateName:s,namespace:p}=(0,C.Oi)(f.o),m=(0,W.eE)({kind:"Template",namespace:p,name:s}),_=async O=>{const{taskId:c}=await r.scaffold({templateRef:m,values:O,secrets:i});E(l({taskId:c}))},u=()=>e.createElement(g.Fg,{to:n()});return e.createElement(C.fC,{attributes:{entityRef:m}},e.createElement(P.T3,{themeId:"website"},e.createElement(P.h4,{pageTitleOverride:"Create a new component",title:"Create a new component",subtitle:"Create new software components using standard templates in your organization"}),e.createElement(h.h4,{namespace:p,templateName:s,onCreate:_,components:t.components,onError:u,extensions:t.customFieldExtensions,formProps:t.formProps,layouts:t.layouts})))};var Pe=Object.defineProperty,Oe=(t,n,l)=>n in t?Pe(t,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[n]=l,De=(t,n,l)=>(Oe(t,typeof n!="symbol"?n+"":n,l),l);const Ce=(0,x.Z)({containerWrapper:{position:"relative",width:"100%",height:"100%"},container:{position:"absolute",top:0,bottom:0,left:0,right:0,overflow:"auto"}});class Me extends e.Component{constructor(){super(...arguments),De(this,"state",{shouldRender:!0})}componentDidUpdate(n){n.invalidator!==this.props.invalidator&&this.setState({shouldRender:!0})}componentDidCatch(n){this.props.setErrorText(n.message),this.setState({shouldRender:!1})}render(){return this.state.shouldRender?this.props.children:null}}function Z(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function I(t){const{content:n,contentIsSpec:l,onDryRun:i,setErrorText:r,fieldExtensions:E=[],layouts:s=[]}=t,p=Ce(),m=(0,L.b)(),[_,u]=(0,e.useState)(),O=(0,e.useMemo)(()=>Object.fromEntries(E.map(({name:c,component:D})=>[c,D])),[E]);return(0,oe.Z)(()=>{try{if(!n){u(void 0);return}const c=F.ZP.parseAllDocuments(n).filter(o=>o).map(o=>o.toJSON())[0];if(!Z(c)){u(void 0);return}let D=c;if(!l){if(!(String(c.kind).toLocaleLowerCase("en-US")==="template")){u(void 0);return}D=Z(c.spec)?c.spec:{}}const{parameters:M}=D;if(!Array.isArray(M)){r("Template parameters must be an array"),u(void 0);return}const A=Object.fromEntries(E.map(({name:o,validation:d})=>[o,d]));r(),u(M.flatMap(o=>Z(o)?[{title:String(o.title),schema:o,validate:(0,h.br)(o,A,{apiHolder:m})}]:[]))}catch(c){r(c.message)}},250,[l,n,m]),_?e.createElement("div",{className:p.containerWrapper},e.createElement("div",{className:p.container},e.createElement(Me,{invalidator:_,setErrorText:r},e.createElement(h.vF,{manifest:{steps:_,title:"Template Editor"},extensions:E,components:O,onCreate:async c=>{await(i==null?void 0:i(c))},layouts:s})))):null}function Te(t){const{setErrorText:n,fieldExtensions:l=[],layouts:i}=t,r=(0,v.u)(),E=(0,v.a)(),{selectedFile:s}=E,p=async _=>{if(s)try{await r.execute({templateContent:s.content,values:_,files:E.files}),n()}catch(u){throw n(String(u.cause||u)),u}},m=s&&s.path.match(/\.ya?ml$/)?s.content:void 0;return e.createElement(I,{onDryRun:p,fieldExtensions:l,setErrorText:n,content:m,layouts:i})}I.DirectoryEditorDryRun=Te;const he=(0,x.Z)(t=>({root:{gridArea:"pageContent",display:"grid",gridTemplateAreas:`
      "controls controls"
      "fieldForm preview"
    `,gridTemplateRows:"auto 1fr",gridTemplateColumns:"1fr 1fr"},controls:{gridArea:"controls",display:"flex",flexFlow:"row nowrap",alignItems:"center",margin:t.spacing(1)},fieldForm:{gridArea:"fieldForm"},preview:{gridArea:"preview"}})),Ae=({customFieldExtensions:t=[],onClose:n})=>{var l,i;const r=he(),E=t.filter(o=>!!o.schema),[s,p]=(0,e.useState)(E[0]),[m,_]=(0,e.useState)({}),[u,O]=(0,e.useState)(Date.now()),c=(0,e.useMemo)(()=>{var o,d;return F.ZP.stringify({parameters:[{title:`${s.name} Example`,properties:{[s.name]:{type:(d=(o=s.schema)==null?void 0:o.returnValue)==null?void 0:d.type,"ui:field":s.name,"ui:options":m}}}]})},[m,s]),D=(0,e.useMemo)(()=>Object.fromEntries(t.map(({name:o,component:d})=>[o,d])),[t]),M=(0,e.useCallback)(o=>{p(o),_({})},[_,p]),A=(0,e.useCallback)(o=>{_(o),O(Date.now())},[_,O]);return e.createElement("main",{className:r.root},e.createElement("div",{className:r.controls},e.createElement(j.Z,{variant:"outlined",size:"small",fullWidth:!0},e.createElement($.Z,{id:"select-field-label"},"Choose Custom Field Extension"),e.createElement(G.Z,{value:s,label:"Choose Custom Field Extension",labelId:"select-field-label",onChange:o=>M(o.target.value)},E.map((o,d)=>e.createElement(V.Z,{key:d,value:o},o.name)))),e.createElement(S.Z,{size:"medium",onClick:n,"aria-label":"Close"},e.createElement(J.Z,null))),e.createElement("div",{className:r.fieldForm},e.createElement(X.Z,null,e.createElement(Y.Z,{title:"Field Options"}),e.createElement(H.Z,null,e.createElement(h.l0,{showErrorList:!1,fields:{...D},noHtml5Validate:!0,formData:m,formContext:{fieldFormState:m},onSubmit:o=>A(o.formData),validator:re.ZP,schema:((l=s.schema)==null?void 0:l.uiOptions)||{}},e.createElement(z.Z,{variant:"contained",color:"primary",type:"submit",disabled:!((i=s.schema)!=null&&i.uiOptions)},"Apply"))))),e.createElement("div",{className:r.preview},e.createElement(X.Z,null,e.createElement(Y.Z,{title:"Example Template Spec"}),e.createElement(H.Z,null,e.createElement(le.ZP,{readOnly:!0,theme:"dark",height:"100%",extensions:[te.il.define(ae.r)],value:c}))),e.createElement(I,{key:u,content:c,contentIsSpec:!0,fieldExtensions:t,setErrorText:()=>null})))},ye=(0,x.Z)({root:{gridArea:"pageContent",display:"grid",gridTemplateAreas:`
      "browser editor preview"
      "results results results"
    `,gridTemplateColumns:"1fr 3fr 2fr",gridTemplateRows:"1fr auto"},browser:{gridArea:"browser",overflow:"auto"},editor:{gridArea:"editor",overflow:"auto"},preview:{gridArea:"preview",overflow:"auto"},results:{gridArea:"results"}}),Re=t=>{const n=ye(),[l,i]=(0,e.useState)();return e.createElement(v.D,{directory:t.directory},e.createElement(v.b,null,e.createElement("main",{className:n.root},e.createElement("section",{className:n.browser},e.createElement(v.T,{onClose:t.onClose})),e.createElement("section",{className:n.editor},e.createElement(v.c.DirectoryEditor,{errorText:l})),e.createElement("section",{className:n.preview},e.createElement(I.DirectoryEditorDryRun,{setErrorText:i,fieldExtensions:t.fieldExtensions,layouts:t.layouts})),e.createElement("section",{className:n.results},e.createElement(v.d,null)))))},Le=`# Edit the template parameters below to see how they will render in the scaffolder form UI
parameters:
  - title: Fill in some steps
    required:
      - name
    properties:
      name:
        title: Name
        type: string
        description: Unique name of the component
      owner:
        title: Owner
        type: string
        description: Owner of the component
        ui:field: OwnerPicker
        ui:options:
          catalogFilter:
            kind: Group
  - title: Choose a location
    required:
      - repoUrl
    properties:
      repoUrl:
        title: Repository Location
        type: string
        ui:field: RepoUrlPicker
        ui:options:
          allowedHosts:
            - github.com
steps:
  - id: fetch-base
    name: Fetch Base
    action: fetch:template
    input:
      url: ./template
      values:
        name: \${{parameters.name}}
`,We=(0,x.Z)(t=>({root:{gridArea:"pageContent",display:"grid",gridTemplateAreas:`
      "controls controls"
      "textArea preview"
    `,gridTemplateRows:"auto 1fr",gridTemplateColumns:"1fr 1fr"},controls:{gridArea:"controls",display:"flex",flexFlow:"row nowrap",alignItems:"center",margin:t.spacing(1)},textArea:{gridArea:"textArea"},preview:{gridArea:"preview"}})),Ie=({defaultPreviewTemplate:t=Le,customFieldExtensions:n=[],onClose:l,layouts:i=[]})=>{const r=We(),E=(0,L.u)(L.l),s=(0,L.u)(T.Ah),[p,m]=(0,e.useState)(""),[_,u]=(0,e.useState)(),[O,c]=(0,e.useState)([]),[D,M]=(0,e.useState)(t),{loading:A}=(0,se.default)(()=>s.getEntities({filter:{kind:"template"},fields:["kind","metadata.namespace","metadata.name","metadata.title","spec.parameters","spec.steps","spec.output"]}).then(({items:d})=>c(d.map(y=>{var R;return{label:(R=y.metadata.title)!=null?R:(0,T.$3)(y,{defaultKind:"template"}),value:y}}))).catch(d=>E.post({message:`Error loading exisiting templates: ${d.message}`,severity:"error"})),[s]),o=(0,e.useCallback)(d=>{m(d),M(F.ZP.stringify(d.spec))},[M]);return e.createElement(e.Fragment,null,A&&e.createElement(ne.Z,null),e.createElement("main",{className:r.root},e.createElement("div",{className:r.controls},e.createElement(j.Z,{variant:"outlined",size:"small",fullWidth:!0},e.createElement($.Z,{id:"select-template-label"},"Load Existing Template"),e.createElement(G.Z,{value:p,label:"Load Existing Template",labelId:"select-template-label",onChange:d=>o(d.target.value)},O.map((d,y)=>e.createElement(V.Z,{key:y,value:d.value},d.label)))),e.createElement(S.Z,{size:"medium",onClick:l},e.createElement(J.Z,null))),e.createElement("div",{className:r.textArea},e.createElement(v.c,{content:D,onUpdate:M,errorText:_})),e.createElement("div",{className:r.preview},e.createElement(I,{content:D,contentIsSpec:!0,fieldExtensions:n,setErrorText:u,layouts:i}))))};function Ue(t){const[n,l]=(0,e.useState)();let i=null;return(n==null?void 0:n.type)==="local"?i=e.createElement(Re,{directory:n.directory,fieldExtensions:t.customFieldExtensions,onClose:()=>l(void 0),layouts:t.layouts}):(n==null?void 0:n.type)==="form"?i=e.createElement(Ie,{defaultPreviewTemplate:t.defaultPreviewTemplate,customFieldExtensions:t.customFieldExtensions,onClose:()=>l(void 0),layouts:t.layouts}):(n==null?void 0:n.type)==="field-explorer"?i=e.createElement(Ae,{customFieldExtensions:t.customFieldExtensions,onClose:()=>l(void 0)}):i=e.createElement(P.VY,null,e.createElement(v.e,{onSelect:r=>{r==="local"?v.W.requestDirectoryAccess().then(E=>l({type:"local",directory:E})).catch(()=>{}):r==="form"?l({type:"form"}):r==="field-explorer"&&l({type:"field-explorer"})}})),e.createElement(P.T3,{themeId:"home"},e.createElement(P.h4,{title:"Template Editor",subtitle:"Edit, preview, and try out templates and template forms"}),i)}const xe=t=>{const{components:{TemplateCardComponent:n,TaskPageComponent:l=f.e,ReviewStepComponent:i,EXPERIMENTAL_TemplateOutputsComponent:r,EXPERIMENTAL_TemplateListPageComponent:E=ve,EXPERIMENTAL_TemplateWizardPageComponent:s=ge}={}}=t,p=(0,g.pC)()||t.children,m=(0,N.PT)(p),_=[...m,...v.f.filter(({name:O})=>!m.some(c=>c.name===O))],u=(0,N.zS)(p);return e.createElement(g.Z5,null,e.createElement(g.AW,{path:"/",element:e.createElement(E,{TemplateCardComponent:n,contextMenu:t.contextMenu,groups:t.groups,templateFilter:t.templateFilter})}),e.createElement(g.AW,{path:f.o.path,element:e.createElement(U.S,null,e.createElement(s,{customFieldExtensions:_,layouts:u,components:{ReviewStepComponent:i},formProps:t.formProps}))}),e.createElement(g.AW,{path:f.w.path,element:e.createElement(l,{TemplateOutputsComponent:r})}),e.createElement(g.AW,{path:f.p.path,element:e.createElement(U.S,null,e.createElement(Ue,{customFieldExtensions:_,layouts:u}))}),e.createElement(g.AW,{path:f.q.path,element:e.createElement(v.A,null)}),e.createElement(g.AW,{path:f.t.path,element:e.createElement(v.L,null)}),e.createElement(g.AW,{path:"*",element:e.createElement(P.mf,{status:"404",statusMessage:"Page not found"})}))}}}]);})();

//# sourceMappingURL=1985.dcb93333.chunk.js.map